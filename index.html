<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ™ºæ…§å¤©æ°£é¡¯ç¤ºå™¨</title>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f2f2f2;
        text-align: center;
    }
    .card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 10px #ccc;
        width: 90%;
        max-width: 400px;
        margin: auto;
    }
    input {
        width: 80%;
        padding: 10px;
        margin-top: 10px;
        border-radius: 8px;
        border: 1px solid #aaa;
        font-size: 16px;
    }
    button {
        margin-top: 15px;
        padding: 12px 24px;
        background: #007BFF;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
    }
    button:hover {
        background: #0056c3;
    }
    #weather-icon {
        width: 80px;
        margin-top: 10px;
    }
    .weather-info {
        margin-top: 20px;
        text-align: left;
        background: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
    }
    .weather-info p {
        margin: 10px 0;
        font-size: 15px;
        line-height: 1.6;
    }
</style>

</head>
<body>

<h2>ğŸŒ¦ æ™ºæ…§å¤©æ°£é¡¯ç¤ºå™¨</h2>

<div class="card">

    <!-- è‡ªå‹•å®šä½ -->
    <h3>ğŸ“ è‡ªå‹•å®šä½å¤©æ°£</h3>
    <button onclick="getLocationWeather()">å–å¾—ç›®å‰ä½ç½®å¤©æ°£</button>

    <hr>

    <!-- æ‰‹å‹•è¼¸å…¥åŸå¸‚æŸ¥è©¢ -->
    <h3>ğŸ” æŸ¥è©¢åŸå¸‚å¤©æ°£</h3>
    <input id="cityInput" type="text" placeholder="è«‹è¼¸å…¥åŸå¸‚ï¼Œä¾‹å¦‚ï¼šå°åŒ—ã€æ±äº¬ æˆ– Taipei,TW">
    <button onclick="getWeatherByCity()">å–å¾—å¤©æ°£</button>

    <h3 id="resultCity"></h3>
    <img id="weather-icon" style="display:none;">
    
    <div class="weather-info" id="weatherInfo" style="display:none;">
        <p id="temperature"></p>
        <p id="description"></p>
        <p id="humidity"></p>
        <p id="rain"></p>
        <p id="clothing"></p>
        <p id="umbrella"></p>
    </div>

</div>

<script>

const apiKey = "e8ce471283bf66d94a2b914cf56ff549";   // é€™æ˜¯ä½ çš„ OpenWeather API Key

// ----------------------
// 1. è‡ªå‹•å®šä½å¤©æ°£
// ----------------------
function getLocationWeather() {
    if (!navigator.geolocation) {
        alert("ä½ çš„è£ç½®ç„¡æ³•å–å¾—å®šä½è³‡è¨Š");
        return;
    }

    navigator.geolocation.getCurrentPosition(
        (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;

            const url =
                `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&lang=zh_tw&units=metric`;

            fetchWeather(url);
        },
        (err) => {
            alert("ç„¡æ³•å–å¾—å®šä½è³‡è¨Šï¼Œè«‹å…è¨±å®šä½");
            console.error(err);
        }
    );
}

// ----------------------
// 2. åŸå¸‚æŸ¥è©¢å¤©æ°£
// ----------------------
// ä¸­æ–‡åŸå¸‚åç¨±å°ç…§è¡¨
const cityMapping = {
    "å°åŒ—": "Taipei,TW",
    "è‡ºåŒ—": "Taipei,TW",
    "æ–°åŒ—": "New Taipei City,TW",
    "æ¡ƒåœ’": "Taoyuan,TW",
    "å°ä¸­": "Taichung,TW",
    "è‡ºä¸­": "Taichung,TW",
    "å°å—": "Tainan,TW",
    "è‡ºå—": "Tainan,TW",
    "é«˜é›„": "Kaohsiung,TW",
    "åŸºéš†": "Keelung,TW",
    "æ–°ç«¹": "Hsinchu,TW",
    "å˜‰ç¾©": "Chiayi,TW",
    "æ±äº¬": "Tokyo,JP",
    "å¤§é˜ª": "Osaka,JP",
    "äº¬éƒ½": "Kyoto,JP",
    "é¦–çˆ¾": "Seoul,KR",
    "é‡œå±±": "Busan,KR",
    "åŒ—äº¬": "Beijing,CN",
    "ä¸Šæµ·": "Shanghai,CN",
    "é¦™æ¸¯": "Hong Kong,HK",
    "æ¾³é–€": "Macau,MO",
    "æ–°åŠ å¡": "Singapore,SG",
    "æ›¼è°·": "Bangkok,TH",
    "å€«æ•¦": "London,GB",
    "å·´é»": "Paris,FR",
    "ç´ç´„": "New York,US",
    "æ´›æ‰ç£¯": "Los Angeles,US",
    "èˆŠé‡‘å±±": "San Francisco,US",
    "é›ªæ¢¨": "Sydney,AU",
    "å¢¨çˆ¾æœ¬": "Melbourne,AU"
};

function getWeatherByCity() {
    let city = document.getElementById("cityInput").value.trim();
    if (city === "") {
        alert("è«‹è¼¸å…¥åŸå¸‚åç¨±ï¼");
        return;
    }

    // å¦‚æœè¼¸å…¥çš„æ˜¯ä¸­æ–‡ï¼Œè½‰æ›æˆè‹±æ–‡åŸå¸‚å
    if (cityMapping[city]) {
        city = cityMapping[city];
    }

    const url =
        `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&lang=zh_tw&units=metric`;

    fetchWeather(url);
}

// ----------------------
// å…±ç”¨ï¼šå–å¾—å¤©æ°£è³‡æ–™ä¸¦é¡¯ç¤º
// ----------------------
function fetchWeather(url) {
    fetch(url)
        .then(res => {
            if (!res.ok) {
                throw new Error(`HTTP error! status: ${res.status}`);
            }
            return res.json();
        })
        .then(data => {
            console.log("API å›æ‡‰:", data); // é™¤éŒ¯ç”¨

            // ä¿®æ­£ï¼šcod å¯èƒ½æ˜¯å­—ä¸²æˆ–æ•¸å­—
            if (data.cod && data.cod != 200) {
                alert("æŸ¥ç„¡å¤©æ°£è³‡è¨Šï¼Œè«‹ç¢ºèªè¼¸å…¥æ˜¯å¦æ­£ç¢º\nå»ºè­°æ ¼å¼ï¼šåŸå¸‚å,åœ‹å®¶ä»£ç¢¼ï¼ˆä¾‹å¦‚ï¼šTaipei,TWï¼‰");
                return;
            }

            document.getElementById("resultCity").innerText = data.name + " çš„å¤©æ°£";

            // åœ–ç¤º
            const iconCode = data.weather[0].icon;
            const iconURL = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
            document.getElementById("weather-icon").src = iconURL;
            document.getElementById("weather-icon").style.display = "block";

            // é¡¯ç¤ºå¤©æ°£è³‡è¨Šå€å¡Š
            document.getElementById("weatherInfo").style.display = "block";

            // æ•¸æ“š
            document.getElementById("temperature").innerText =
                "ğŸŒ¡ æº«åº¦: " + data.main.temp + "Â°C (é«”æ„Ÿ: " + data.main.feels_like + "Â°C)";

            document.getElementById("description").innerText =
                "â˜ ç‹€æ…‹: " + data.weather[0].description;

            // æ¿•åº¦
            document.getElementById("humidity").innerText =
                "ğŸ’§ æ¿•åº¦: " + data.main.humidity + "%";

            // é™é›¨æ©Ÿç‡å’Œé›¨å…·å»ºè­°
            const rain = data.rain ? data.rain["1h"] || data.rain["3h"] || 0 : 0;
            const weatherMain = data.weather[0].main.toLowerCase();
            
            if (rain > 0) {
                document.getElementById("rain").innerText =
                    "ğŸŒ§ é™é›¨é‡: " + rain + "mm";
                document.getElementById("umbrella").innerText =
                    "â˜” å»ºè­°æ”œå¸¶é›¨å…·ï¼";
                document.getElementById("umbrella").style.color = "#ff6b6b";
                document.getElementById("umbrella").style.fontWeight = "bold";
            } else if (weatherMain.includes("rain") || weatherMain.includes("drizzle")) {
                document.getElementById("rain").innerText =
                    "ğŸŒ§ å¯èƒ½æœ‰é™é›¨";
                document.getElementById("umbrella").innerText =
                    "â˜” å»ºè­°æ”œå¸¶é›¨å…·ä»¥é˜²è¬ä¸€";
                document.getElementById("umbrella").style.color = "#ffa500";
                document.getElementById("umbrella").style.fontWeight = "bold";
            } else if (data.clouds && data.clouds.all > 70) {
                document.getElementById("rain").innerText =
                    "â˜ å¤šé›²ï¼Œé™é›¨æ©Ÿç‡ä½";
                document.getElementById("umbrella").innerText =
                    "ğŸŒ‚ å¯è€ƒæ…®å¸¶æŠŠå‚˜";
                document.getElementById("umbrella").style.color = "#888";
            } else {
                document.getElementById("rain").innerText =
                    "â˜€ é™é›¨æ©Ÿç‡ä½";
                document.getElementById("umbrella").innerText =
                    "ğŸ˜Š ç„¡éœ€æ”œå¸¶é›¨å…·";
                document.getElementById("umbrella").style.color = "#4caf50";
            }

            // ç©¿æ­å»ºè­°
            const temp = data.main.temp;
            let clothingAdvice = "";
            
            if (temp >= 30) {
                clothingAdvice = "ğŸ‘• éå¸¸ç‚ç†±ï¼å»ºè­°ç©¿è‘—è¼•è–„é€æ°£è¡£ç‰©ã€çŸ­è¢–çŸ­è¤²ï¼Œæ³¨æ„é˜²æ›¬";
            } else if (temp >= 25) {
                clothingAdvice = "ğŸ‘” ç‚ç†±å¤©æ°£ï¼Œé©åˆçŸ­è¢–ã€è–„å¤–å¥—ï¼Œæ³¨æ„è£œå……æ°´åˆ†";
            } else if (temp >= 20) {
                clothingAdvice = "ğŸ§¥ èˆ’é©æº«åº¦ï¼Œé•·è¢–è¡£ç‰©æˆ–è–„å¤–å¥—å³å¯";
            } else if (temp >= 15) {
                clothingAdvice = "ğŸ§¥ ç¨æ¶¼ï¼Œå»ºè­°ç©¿è‘—é•·è¢–åŠ è–„å¤–å¥—æˆ–é¢¨è¡£";
            } else if (temp >= 10) {
                clothingAdvice = "ğŸ§¥ åå†·ï¼Œå»ºè­°ç©¿è‘—åšå¤–å¥—æˆ–æ¯›è¡£";
            } else if (temp >= 5) {
                clothingAdvice = "ğŸ§£ å¯’å†·ï¼å»ºè­°ç©¿è‘—åšé‡å¤–å¥—ã€æ¯›è¡£ï¼Œå¯åŠ åœå·¾";
            } else {
                clothingAdvice = "ğŸ§£ éå¸¸å¯’å†·ï¼å»ºè­°ç©¿è‘—ç¾½çµ¨å¤–å¥—ã€æ¯›è¡£ï¼Œé…æˆ´åœå·¾æ‰‹å¥—";
            }
            
            document.getElementById("clothing").innerText = clothingAdvice;
        })
        .catch(err => {
            console.error("éŒ¯èª¤è©³æƒ…:", err);
            alert("ç„¡æ³•å–å¾—å¤©æ°£è³‡æ–™\n" + 
                  "å¯èƒ½åŸå› ï¼š\n" +
                  "1. API Key å°šæœªå•Ÿç”¨ï¼ˆæ–°è¨»å†Šéœ€ç­‰å¾…æ•¸å°æ™‚ï¼‰\n" +
                  "2. åŸå¸‚åç¨±æ ¼å¼éŒ¯èª¤ï¼ˆå»ºè­°æ ¼å¼ï¼šåŸå¸‚å,åœ‹å®¶ä»£ç¢¼ï¼‰\n" +
                  "3. ç¶²è·¯é€£ç·šå•é¡Œ");
        });
}

</script>

</body>
</html>