<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ™ºæ…§å¤©æ°£é¡¯ç¤ºå™¨</title>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f2f2f2;
        text-align: center;
    }
    .card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 10px #ccc;
        width: 90%;
        max-width: 400px;
        margin: auto;
    }
    input {
        width: 80%;
        padding: 10px;
        margin-top: 10px;
        border-radius: 8px;
        border: 1px solid #aaa;
        font-size: 16px;
    }
    button {
        margin-top: 15px;
        padding: 12px 24px;
        background: #007BFF;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
    }
    button:hover {
        background: #0056c3;
    }
    #weather-icon {
        width: 80px;
        margin-top: 10px;
    }
</style>

</head>
<body>

<h2>ğŸŒ¦ æ™ºæ…§å¤©æ°£é¡¯ç¤ºå™¨</h2>

<div class="card">

    <h3>ğŸ“ è‡ªå‹•å®šä½å¤©æ°£</h3>
    <button onclick="getLocationWeather()">å–å¾—ç›®å‰ä½ç½®å¤©æ°£</button>

    <hr>

    <h3>ğŸ” æŸ¥è©¢åŸå¸‚å¤©æ°£</h3>
    <input id="cityInput" type="text" placeholder="è«‹è¼¸å…¥åŸå¸‚ï¼Œä¾‹å¦‚ï¼šTaipei">
    <button onclick="getWeatherByCity()">å–å¾—å¤©æ°£</button>

    <h3 id="resultCity"></h3>
    <img id="weather-icon" style="display:none;">
    <p id="temperature"></p>
    <p id="description"></p>

</div>

<script>

const apiKey = "e8ce471283bf66d94a2b914cf56ff549";   // â† æ›¿æ›æˆä½ çš„ OpenWeather API Key

// ----------------------
// 1. è‡ªå‹•å®šä½å¤©æ°£
// ----------------------
function getLocationWeather() {
    if (!navigator.geolocation) {
        alert("ä½ çš„è£ç½®ç„¡æ³•å–å¾—å®šä½è³‡è¨Š");
        return;
    }

    navigator.geolocation.getCurrentPosition(
        (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;

            const url =
                `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&lang=zh_tw&units=metric`;

            fetchWeather(url);
        },
        (err) => {
            alert("ç„¡æ³•å–å¾—å®šä½è³‡è¨Šï¼Œè«‹å…è¨±å®šä½");
            console.error(err);
        }
    );
}

// ----------------------
// 2. åŸå¸‚æŸ¥è©¢å¤©æ°£
// ----------------------
function getWeatherByCity() {
    const city = document.getElementById("cityInput").value;
    if (city === "") {
        alert("è«‹è¼¸å…¥åŸå¸‚åç¨±ï¼");
        return;
    }

    const url =
        `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&lang=zh_tw&units=metric`;

    fetchWeather(url);
}

// ----------------------
// å…±ç”¨ï¼šå–å¾—å¤©æ°£è³‡æ–™ä¸¦é¡¯ç¤º
// ----------------------
function fetchWeather(url) {
    fetch(url)
        .then(res => res.json())
        .then(data => {

            if (data.cod !== 200) {
                alert("æŸ¥ç„¡å¤©æ°£è³‡è¨Šï¼Œè«‹ç¢ºèªè¼¸å…¥æ˜¯å¦æ­£ç¢º");
                return;
            }

            document.getElementById("resultCity").innerText = data.name + " çš„å¤©æ°£";

            // åœ–ç¤º
            const iconCode = data.weather[0].icon;
            const iconURL = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
            document.getElementById("weather-icon").src = iconURL;
            document.getElementById("weather-icon").style.display = "block";

            // æ•¸æ“š
            document.getElementById("temperature").innerText =
                "ğŸŒ¡ æº«åº¦: " + data.main.temp + "Â°C";

            document.getElementById("description").innerText =
                "â˜ ç‹€æ…‹: " + data.weather[0].description;
        })
        .catch(err => {
            console.error(err);
            alert("ç„¡æ³•å–å¾—å¤©æ°£è³‡æ–™");
        });
}

</script>

</body>
</html>
